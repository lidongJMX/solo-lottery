# Solo Lottery 测试脚本说明

本目录包含了完整的 Solo Lottery 系统功能测试脚本，用于验证管理页功能和抽奖页功能的正确性。

## 📁 文件结构

```
scripts/
├── test-admin-functions.js     # 管理页功能测试脚本
├── test-lottery-functions.js   # 抽奖页功能测试脚本
├── run-all-tests.js           # 主测试脚本
└── README.md                  # 本说明文档
```

## 🚀 快速开始

### 1. 安装依赖

```bash
cd backend
npm install
```

### 2. 启动后端服务

```bash
npm run dev
```

### 3. 运行测试

```bash
# 运行所有测试（不包含重置功能）
npm run test

# 仅测试管理功能
npm run test:admin

# 仅测试抽奖功能
npm run test:lottery

# 运行完整测试（包含重置功能，会清空数据）
npm run test:full
```

## 📋 测试内容

### 管理页功能测试 (`test-admin-functions.js`)

#### 🏆 奖项管理测试
- ✅ 获取所有奖项
- ✅ 添加新奖项
- ✅ 更新奖项信息
- ✅ 获取单个奖项
- ✅ 删除奖项
- ✅ 数据验证和错误处理

#### 👥 参与者管理测试
- ✅ 获取所有参与者
- ✅ 添加新参与者
- ✅ 更新参与者信息
- ✅ 删除参与者
- ✅ 批量导入功能
- ✅ 获取可参与抽奖人员
- ✅ 重复检测和数据验证

#### 🔧 系统状态测试
- ✅ 获取抽奖状态
- ✅ 获取奖项配置
- ✅ 获取参与者姓名列表

### 抽奖页功能测试 (`test-lottery-functions.js`)

#### 🎲 抽奖基础功能
- ✅ 获取抽奖状态
- ✅ 获取中奖记录
- ✅ 获取可用奖项

#### 🎯 抽奖执行功能
- ✅ 执行抽奖操作
- ✅ 获取特定奖项中奖记录
- ✅ 撤销中奖记录
- ✅ 重新抽奖

#### 🔄 轮次管理功能
- ✅ 获取当前轮次
- ✅ 进入下一轮
- ✅ 轮次状态验证

#### 🔄 重置功能测试
- ✅ 重置前状态记录
- ✅ 执行重置操作
- ✅ 重置后状态验证
- ✅ 重置效果确认

#### 🛡️ 规则和边界测试
- ✅ 无效奖项ID处理
- ✅ 抽取数量为0的处理
- ✅ 超出剩余数量的处理
- ✅ 删除不存在记录的处理

#### ⚡ 性能测试
- ✅ 状态查询性能
- ✅ 中奖记录查询性能
- ✅ 响应时间统计

## 📊 测试报告

测试完成后，会在以下目录生成详细报告：

- `test-data/` - 测试过程中生成的数据文件
- `test-results/` - 各项测试的结果文件
- `test-reports/` - 完整的测试报告（JSON格式）

### 报告内容包括：
- 测试总结（通过/失败数量、总耗时）
- 详细测试结果
- 性能数据
- 错误信息（如有）

## 🔧 命令行选项

```bash
# 显示帮助信息
node src/scripts/run-all-tests.js --help

# 仅执行管理功能测试
node src/scripts/run-all-tests.js --admin-only

# 仅执行抽奖功能测试
node src/scripts/run-all-tests.js --lottery-only

# 包含重置功能测试（会清空所有数据）
node src/scripts/run-all-tests.js --include-reset
```

## ⚠️ 注意事项

1. **服务器要求**：测试前请确保后端服务已启动并运行在端口 3001
2. **数据安全**：重置测试（`--include-reset`）会清空所有抽奖数据，请谨慎使用
3. **网络连接**：测试脚本会自动检查服务器连接状态
4. **依赖要求**：需要 `node-fetch` 依赖，已在 package.json 中配置

## 🐛 故障排除

### 常见问题

1. **连接失败**
   ```
   ❌ 无法连接到后端服务
   ```
   **解决方案**：确保后端服务已启动 (`npm run dev`)

2. **依赖缺失**
   ```
   Error: Cannot find module 'node-fetch'
   ```
   **解决方案**：运行 `npm install` 安装依赖

3. **权限错误**
   ```
   Error: EACCES: permission denied
   ```
   **解决方案**：检查文件权限或使用管理员权限运行

### 调试模式

如需查看详细的API请求和响应，可以修改脚本中的 `log` 函数来输出更多调试信息。

## 📈 扩展测试

如需添加新的测试用例：

1. 在对应的测试文件中添加新的测试函数
2. 在主测试脚本中调用新函数
3. 更新本文档说明新增的测试内容

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进测试脚本的功能和覆盖率。