# 项目决策记录31 - 修复奖项管理功能

## 问题描述
管理后台的奖项管理功能存在以下问题：
1. 添加奖项时缺少`draw_count`字段的处理
2. 编辑奖项时缺少`draw_count`字段的处理
3. 奖项等级显示标签类型错误（使用文字等级而非数字等级）
4. 后端API未正确处理`draw_count`字段
5. 缺少单次抽取人数的验证逻辑

## 解决方案

### 前端修复（AdminPage.vue）

1. **修复添加奖项功能**
   - 在`addAward`函数中添加`draw_count`字段验证
   - 添加单次抽取人数不能大于总数量的验证
   - 在API调用时包含`draw_count`字段

2. **修复编辑奖项功能**
   - 在`updateAward`函数中添加`draw_count`字段验证
   - 添加单次抽取人数不能大于总数量的验证
   - 在API调用时包含`draw_count`字段

3. **修复奖项等级显示**
   - 修改`getAwardTagType`函数，使其处理数字等级（1-7）而非文字等级
   - 为不同等级设置合适的标签颜色

### 后端修复（awards.js）

1. **修复添加奖项API**
   - 从请求体中提取`draw_count`字段
   - 添加`draw_count`的验证逻辑
   - 在数据库插入时包含`draw_count`字段

2. **修复更新奖项API**
   - 从请求体中提取`draw_count`字段
   - 添加`draw_count`的验证逻辑
   - 在数据库更新时包含`draw_count`字段

## 技术细节

### 验证规则
- `draw_count`必须大于0
- `draw_count`不能超过奖项总数量
- 所有必填字段都必须提供

### 等级标签映射
- 等级1：danger（红色）
- 等级2：success（绿色）
- 等级3：warning（橙色）
- 等级4-7：info（蓝色）

## 影响范围
- 前端：`frontend/src/components/AdminPage.vue`
- 后端：`backend/src/routes/awards.js`

## 测试建议
1. 测试添加新奖项功能
2. 测试编辑现有奖项功能
3. 测试删除奖项功能
4. 验证单次抽取人数的各种边界情况
5. 确认奖项等级标签显示正确

## 修复时间
2024-12-19

## 修复状态
✅ 已完成