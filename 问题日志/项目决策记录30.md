# 项目决策记录30 - 奖项列表字段顺序优化与编辑删除功能完善

## 决策日期
2024-12-19

## 问题描述
用户要求奖项列表数据的字段顺序与数据库中一致，并且可以编辑奖项和删除奖项。原有实现存在以下问题：
1. 前端显示的字段顺序与数据库不一致
2. 字段映射混乱，存在多余的数据转换
3. 编辑奖项时数据映射错误
4. 表单字段与数据库字段不匹配

## 数据库字段结构
根据 `backend/src/database/init.js` 中的Award表定义，字段顺序为：
```sql
CREATE TABLE IF NOT EXISTS "Award" (
  "id" INTEGER PRIMARY KEY AUTOINCREMENT,
  "name" VARCHAR(255) NOT NULL,
  "description" TEXT,
  "count" INTEGER NOT NULL,
  "remaining_count" INTEGER NOT NULL,
  "level" INTEGER NOT NULL,
  "draw_count" INTEGER NOT NULL DEFAULT 1,
  "createdAt" DATETIME NOT NULL,
  "updatedAt" DATETIME NOT NULL
)
```

## 决策内容

### 1. 调整表格字段顺序
按照数据库字段顺序重新排列表格列：
- ID
- 奖项名称 (name)
- 奖项描述 (description)
- 总数量 (count)
- 剩余数量 (remaining_count)
- 奖项等级 (level)
- 单次抽取 (draw_count)
- 创建时间 (createdAt)
- 操作

### 2. 简化数据映射
- 移除 `fetchAwards` 方法中的额外数据转换
- 直接使用数据库返回的原始数据
- 确保前端字段名与数据库字段名一致

### 3. 修正表单字段
重新设计奖项表单，确保字段与数据库一致：
```javascript
const newAward = ref({
  name: '',           // 奖项名称
  description: '',    // 奖项描述
  count: 1,          // 总数量
  level: 1,          // 奖项等级（数字）
  draw_count: 1      // 单次抽取数量
})
```

### 4. 优化奖项等级选择
- 将奖项等级改为数字选择（1-7）
- 移除文字等级选项（特等奖、一等奖等）
- 与数据库中的INTEGER类型保持一致

### 5. 完善编辑删除功能
- 修正 `editAward` 方法的数据映射
- 确保 `addAward` 和 `updateAward` 方法使用正确的字段名
- 保持删除功能不变

## 技术实现

### 修改的文件
- `frontend/src/components/AdminPage.vue`

### 主要变更

1. **表格列调整**：
   - 按数据库字段顺序重新排列
   - 使用正确的属性名（count, remaining_count, draw_count, createdAt）
   - 移除计算字段，直接显示数据库字段

2. **数据获取简化**：
   ```javascript
   // 修改前
   awards.value = data.map(award => ({
     ...award,
     drawn: award.drawn_count || 0,
     drawCount: award.draw_count || award.quantity,
     awardLevel: award.level
   }))
   
   // 修改后
   awards.value = data
   ```

3. **表单字段修正**：
   - 奖项名称：`newAward.level` → `newAward.name`
   - 奖项描述：`newAward.name` → `newAward.description`
   - 奖项数量：`newAward.quantity` → `newAward.count`
   - 奖项等级：`newAward.awardLevel` → `newAward.level`
   - 单次抽取：`newAward.drawCount` → `newAward.draw_count`

4. **API调用优化**：
   ```javascript
   // 统一使用数据库字段名
   const awardData = {
     name: newAward.value.name,
     description: newAward.value.description || '',
     level: newAward.value.level,
     count: newAward.value.count
   }
   ```

## 预期效果

### 用户体验
- 奖项列表字段顺序与数据库一致，便于理解
- 编辑奖项功能正常工作
- 删除奖项功能保持稳定
- 数据显示更加准确

### 代码质量
- 减少不必要的数据转换
- 字段映射更加清晰
- 代码逻辑更加简洁
- 与后端API保持一致

## 风险评估

### 低风险
- 主要是前端显示调整，不影响数据库结构
- 后端API接口保持不变
- 核心业务逻辑未改变

### 注意事项
- 需要测试编辑和删除功能是否正常
- 确保奖项等级的数字显示符合用户期望
- 验证统计数据计算是否正确

## 后续计划
- 测试奖项的增删改功能
- 验证与抽奖功能的兼容性
- 根据用户反馈调整奖项等级显示方式

## 决策理由
通过调整字段顺序与数据库保持一致，简化数据映射逻辑，可以提高代码的可维护性和数据的一致性。同时确保编辑删除功能正常工作，满足用户的基本管理需求。