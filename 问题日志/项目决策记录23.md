# 项目决策记录23 - 数据库结构重新设计

## 决策日期
2024年12月19日

## 决策背景
原有的数据库结构相对简单，只包含participants、awards和winners三个表，无法满足更复杂的抽奖系统需求。需要重新设计数据库结构以支持：
- 管理员账户管理
- 更详细的奖项信息管理
- 抽奖轮次管理
- 更完善的参与者信息管理
- 更详细的中奖记录管理

## 决策内容

### 新数据库表结构设计

1. **管理员表 (Admins)**
   - 存储系统管理员账户信息
   - 包含用户名、密码、创建时间等字段
   - 用户名唯一约束

2. **奖项表 (Awards)**
   - 存储所有可抽取的奖项信息
   - 包含奖项名称、描述、数量、剩余数量、等级等字段
   - 支持每次抽取数量配置

3. **轮次表 (Epoches)**
   - 存储抽奖活动的轮次信息
   - 支持多轮次抽奖管理
   - 包含轮次状态控制

4. **参与者表 (Participants)**
   - 存储参与抽奖的人员信息
   - 包含姓名、用户ID、部门、权重等字段
   - 支持中奖状态和中奖次数统计
   - 记录最高奖项等级

5. **中奖记录表 (Winners)**
   - 存储所有中奖信息
   - 关联参与者和奖项
   - 包含轮次信息和中奖时间
   - 设置外键约束确保数据完整性

### 技术实现要点

1. **外键约束管理**
   - 在表创建时禁用外键约束检查
   - 创建完成后启用外键约束
   - 确保数据完整性

2. **默认数据初始化**
   - 创建默认管理员账户 (admin/admin123)
   - 初始化第一轮抽奖轮次
   - 添加示例奖项数据
   - 添加测试参与者数据

3. **数据类型优化**
   - 使用VARCHAR替代TEXT提高查询性能
   - 使用TINYINT优化布尔值存储
   - 统一使用ISO格式的DATETIME

## 决策影响

### 正面影响
- 数据库结构更加规范和完整
- 支持更复杂的业务逻辑
- 提供更好的数据完整性保障
- 为后续功能扩展奠定基础

### 需要注意的问题
- 现有API接口需要相应调整
- 前端组件可能需要适配新的数据结构
- 需要数据迁移策略（如果有现有数据）

## 后续行动
1. 更新相关的API路由以适配新表结构
2. 修改前端组件以使用新的数据字段
3. 添加管理员登录功能
4. 实现轮次管理功能
5. 优化抽奖算法以支持权重和轮次

## 决策状态
已实施 - 数据库初始化文件已更新完成