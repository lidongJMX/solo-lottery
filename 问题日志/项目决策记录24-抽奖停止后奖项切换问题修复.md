# 项目决策记录24-抽奖停止后奖项切换问题修复

## 问题描述
当前奖项停止抽奖后页面会直接切换到一等奖，导致弹窗中显示的奖项信息不正确。

## 问题分析
1. **问题根源**：在 `nextRound` 函数中，代码会强制重置 `currentIndex.value = 0`，这会导致页面切换到第一个奖项（一等奖）
2. **影响范围**：当用户在非一等奖的奖项上进行抽奖后，点击下一轮时，页面会自动切换到一等奖，但弹窗中显示的仍是之前奖项的中奖者信息
3. **用户体验问题**：造成奖项信息与中奖者信息不匹配的混乱

## 解决方案

### 修改内容
1. **优化 `closeWinnerDialog` 函数**：
   - 保持当前奖项不变，只重置动画状态
   - 更新注释说明保持奖项状态的意图

2. **优化 `nextRound` 函数**：
   - 改变奖项重置逻辑，保持当前选中的奖项
   - 只有当当前奖项索引超出范围时才重置为0
   - 确保奖项切换的连续性和用户体验

### 具体修改

#### 文件：`frontend/src/components/LotteryPage.vue`

**修改前**：
```javascript
// 关闭中奖弹窗
const closeWinnerDialog = () => {
  showWinnerDialog.value = false;
  // 重置动画状态
  setTimeout(() => {
    showWinnerNames.value = false;
    currentWinners.value = [];
    rollingNames.value = [];
    isSlowingDown.value = false;
  }, 300);
};

// 重置抽奖状态
currentIndex.value = 0;
currentAward.value = awards.value[0] || null;
drawCount.value = currentAward.value?.draw_count || 1;
```

**修改后**：
```javascript
// 关闭中奖弹窗
const closeWinnerDialog = () => {
  showWinnerDialog.value = false;
  // 重置动画状态，但保持当前奖项不变
  setTimeout(() => {
    showWinnerNames.value = false;
    currentWinners.value = [];
    rollingNames.value = [];
    isSlowingDown.value = false;
  }, 300);
};

// 重置抽奖状态，但保持当前选中的奖项
if (awards.value.length > 0) {
  // 如果当前奖项索引超出范围，则重置为0
  if (currentIndex.value >= awards.value.length) {
    currentIndex.value = 0;
  }
  currentAward.value = awards.value[currentIndex.value] || awards.value[0];
  drawCount.value = currentAward.value?.draw_count || 1;
}
```

## 预期效果
1. **保持奖项连续性**：用户在某个奖项上进行抽奖后，页面不会自动切换到其他奖项
2. **信息一致性**：弹窗中显示的奖项信息与当前选中的奖项保持一致
3. **更好的用户体验**：用户可以连续在同一奖项上进行多轮抽奖，无需重新选择
4. **容错处理**：当奖项索引超出范围时，仍能正确回退到第一个奖项

## 测试建议
1. 在非一等奖的奖项上进行抽奖
2. 查看中奖弹窗显示的奖项信息是否正确
3. 点击下一轮按钮，确认页面不会自动切换到一等奖
4. 验证多轮抽奖的连续性

## 风险评估
- **低风险**：修改仅涉及UI状态管理，不影响核心抽奖逻辑
- **向后兼容**：保持了原有的功能，只是优化了用户体验
- **边界情况处理**：添加了索引范围检查，提高了代码健壮性

---

**修复时间**：2024年12月
**影响模块**：前端抽奖页面
**修复类型**：用户体验优化