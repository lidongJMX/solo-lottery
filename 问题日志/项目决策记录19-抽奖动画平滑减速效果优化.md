# 项目决策记录19-抽奖动画平滑减速效果优化

## 问题描述
用户要求开发抽奖功能，按下空格后人名在3秒内缓慢停止且平滑过渡，主要是为了突出抽奖的刺激感。

## 原有实现
- 人名每500ms更换一次
- 按下空格键立即停止抽奖
- 缺乏渐进式的减速效果
- 抽奖体验不够刺激

## 解决方案

### 1. 新增状态管理
- 添加 `isSlowingDown` 状态：标识是否正在减速过程中
- 添加 `slowDownStartTime` 状态：记录减速开始时间
- 添加 `slowDownDuration` 常量：设置减速持续时间为3秒

### 2. 重构滚动逻辑
- 将原有的 `setInterval` 改为递归的 `setTimeout`
- 初始滚动间隔设为100ms，实现快速滚动效果
- 实现动态间隔调整机制

### 3. 平滑减速算法
- 使用缓动函数 `easeOut = 1 - Math.pow(1 - progress, 3)` 实现平滑减速
- 滚动间隔从100ms逐渐增加到1600ms
- 减速过程持续3秒钟

### 4. 优化用户交互
- 按下空格键不再立即停止，而是开始减速过程
- 防止重复触发减速（添加 `isSlowingDown` 检查）
- 减速完成后自动确定最终中奖者

## 技术实现细节

### 核心算法
```javascript
if (isSlowingDown.value) {
  // 计算减速进度 (0-1)
  const elapsed = Date.now() - slowDownStartTime.value;
  const progress = Math.min(elapsed / slowDownDuration, 1);
  
  // 使用缓动函数实现平滑减速
  const easeOut = 1 - Math.pow(1 - progress, 3);
  interval = 100 + (1500 * easeOut); // 从100ms逐渐增加到1600ms
  
  if (progress >= 1) {
    // 减速完成，停止抽奖
    finalizeDraw();
    return;
  }
}
```

### 函数重构
- `startRolling()`: 重构为递归调用模式
- `stopDraw()`: 改为触发减速过程
- `finalizeDraw()`: 新增函数处理最终确定中奖者
- 清理函数：将 `clearInterval` 改为 `clearTimeout`

## 用户体验改进

1. **增强刺激感**：快速滚动到缓慢停止的过程增加了紧张感
2. **平滑过渡**：使用缓动函数确保视觉效果自然流畅
3. **可控时长**：3秒的减速时间既不会太短失去效果，也不会太长影响体验
4. **防误操作**：减速过程中无法重复触发

## 测试要点

1. 验证按下空格键后是否开始减速
2. 确认减速过程持续约3秒
3. 检查滚动速度是否平滑递减
4. 验证最终中奖者确定的准确性
5. 测试多次抽奖的状态重置

## 影响范围
- 文件：`frontend/src/components/LotteryPage.vue`
- 影响功能：抽奖动画效果
- 兼容性：保持原有API接口不变

## 后续优化建议

1. 可考虑添加音效配合动画效果
2. 可以让用户自定义减速时长
3. 可以添加更多缓动函数选项
4. 考虑添加视觉特效（如高亮、闪烁等）

---

**修改时间**: 2024年12月
**修改人**: AI Assistant
**状态**: 已完成