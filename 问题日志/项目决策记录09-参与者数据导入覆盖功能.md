# 项目决策记录09-参与者数据导入覆盖功能

## 日期
2024年12月19日

## 问题描述
用户需要在导入参与者数据时，能够覆盖原有的参与者数据，而不是仅仅添加新的参与者。

## 问题分析
原有的数据库初始化代码中，参与者数据导入逻辑被注释掉了，并且即使启用，也只是检查参与者是否已存在，如果不存在才插入，这样无法实现覆盖原有数据的需求。

## 解决方案

### 修改内容
1. **启用参与者数据导入功能**：取消了原本被注释的参与者数据导入代码
2. **实现覆盖逻辑**：
   - 在插入新参与者数据前，先执行 `DELETE FROM "Participant"` 清空现有参与者数据
   - 然后直接插入所有默认参与者数据，不再检查是否已存在

### 技术实现
- 修改文件：`backend/src/database/init.js`
- 在第184-205行区域进行修改
- 添加了清空参与者表的SQL语句
- 移除了重复性检查逻辑，改为直接插入

### 代码变更
```javascript
// 原代码（被注释）
// const defaultParticipants = [...]
// for (const name of defaultParticipants) {
//   const existing = await dbGet('SELECT id FROM "Participant" WHERE name = ?', [name]);
//   if (!existing) {
//     await dbRun(...);
//   }
// }

// 新代码（覆盖模式）
const defaultParticipants = [...];
// 清空现有参与者数据
await dbRun('DELETE FROM "Participant"');
// 插入新的参与者数据
for (const name of defaultParticipants) {
  await dbRun(...);
}
```

## 影响评估

### 正面影响
1. **数据一致性**：确保每次初始化都有完全一致的参与者数据
2. **操作简化**：管理员不需要手动清理旧数据
3. **功能完整性**：满足了用户覆盖数据的需求

### 潜在风险
1. **数据丢失风险**：如果有重要的参与者数据，会被完全清除
2. **关联数据影响**：如果参与者已有中奖记录，需要考虑外键约束

### 风险缓解
- 该功能主要用于系统初始化阶段
- 在生产环境中应谨慎使用，建议添加数据备份机制

## 后续建议
1. 考虑添加数据备份功能，在清空数据前自动备份
2. 可以考虑添加配置选项，让用户选择是覆盖还是追加模式
3. 在管理界面中添加相应的提示信息，告知用户操作的影响

## 测试建议
1. 测试数据库初始化功能是否正常工作
2. 验证参与者数据是否正确导入
3. 确认多次运行初始化不会产生重复数据
4. 测试在有中奖记录的情况下的行为（如果适用）