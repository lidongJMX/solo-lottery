# 项目决策记录合并版 - 管理功能优化

## 概述
本文档合并了项目决策记录25、30等，涵盖了管理页面功能的优化和完善。

---

## 第一阶段：术语统一（记录25）

### 术语统一：奖品改为奖项
**日期**：2024年12月19日

**问题描述**：
用户要求在项目中统一使用"奖项"而不是"奖品"的术语，以保持项目术语的一致性和专业性。

**发现的问题**：
项目中存在大量使用"奖品"术语的地方，包括：
1. 前端界面显示文本
2. 后端API错误消息
3. 代码注释
4. 变量和函数命名相关的注释

**解决方案**：
系统性地将项目中所有"奖品"术语替换为"奖项"。

#### 前端文件修改
**AdminPage.vue**：
- 统计卡片："奖品总数" → "奖项总数"
- 图表标题："奖品分布统计" → "奖项分布统计"
- 表格列标题："奖品" → "奖项"
- 表单标签："奖品图片" → "奖项图片"
- 代码注释："奖品数据" → "奖项数据"
- 提示消息："删除该奖品" → "删除该奖项"

**LotteryPage.vue**：
- 注释："奖品展示" → "奖项展示"
- 注释："奖品信息容器" → "奖项信息容器"
- 注释："奖品选择" → "奖项选择"
- 表格列标题："奖品" → "奖项"

#### 后端文件修改
**awards.js**：
- 路由注释："获取所有奖品" → "获取所有奖项"
- 错误消息："奖品不存在" → "奖项不存在"
- 验证消息："奖品等级、名称和数量不能为空" → "奖项等级、名称和数量不能为空"
- 所有相关的错误提示和日志消息

**lottery.js**：
- 错误消息："请选择奖品" → "请选择奖项"
- 注释："检查奖品是否存在" → "检查奖项是否存在"
- 注释："更新奖品剩余数量" → "更新奖项剩余数量"
- 所有相关的注释和错误消息

#### 术语对照表
| 原术语 | 新术语 |
|--------|--------|
| 奖品 | 奖项 |
| 奖品总数 | 奖项总数 |
| 奖品分布 | 奖项分布 |
| 奖品配置 | 奖项配置 |
| 奖品管理 | 奖项管理 |
| 奖品信息 | 奖项信息 |

**修改统计**：
- 修改文件数量：4个文件
- 修改行数：约30+处修改
- 涉及范围：前端UI、后端API、错误消息、代码注释

---

## 第二阶段：数据管理优化（记录30）

### 奖项列表字段顺序优化与编辑删除功能完善
**日期**：2024-12-19

**问题描述**：
用户要求奖项列表数据的字段顺序与数据库中一致，并且可以编辑奖项和删除奖项。原有实现存在以下问题：
1. 前端显示的字段顺序与数据库不一致
2. 字段映射混乱，存在多余的数据转换
3. 编辑奖项时数据映射错误
4. 表单字段与数据库字段不匹配

#### 数据库字段结构
根据 `backend/src/database/init.js` 中的Award表定义，字段顺序为：
```sql
CREATE TABLE IF NOT EXISTS "Award" (
  "id" INTEGER PRIMARY KEY AUTOINCREMENT,
  "name" VARCHAR(255) NOT NULL,
  "description" TEXT,
  "count" INTEGER NOT NULL,
  "remaining_count" INTEGER NOT NULL,
  "level" INTEGER NOT NULL,
  "draw_count" INTEGER NOT NULL DEFAULT 1,
  "createdAt" DATETIME NOT NULL,
  "updatedAt" DATETIME NOT NULL
)
```

#### 解决方案

**1. 调整表格字段顺序**
按照数据库字段顺序重新排列表格列：
- ID
- 奖项名称 (name)
- 奖项描述 (description)
- 总数量 (count)
- 剩余数量 (remaining_count)
- 奖项等级 (level)
- 单次抽取 (draw_count)
- 创建时间 (createdAt)
- 操作

**2. 简化数据映射**
```javascript
// 修改前
awards.value = data.map(award => ({
  ...award,
  drawn: award.drawn_count || 0,
  drawCount: award.draw_count || award.quantity,
  awardLevel: award.level
}))

// 修改后
awards.value = data
```

**3. 修正表单字段**
重新设计奖项表单，确保字段与数据库一致：
```javascript
const newAward = ref({
  name: '',           // 奖项名称
  description: '',    // 奖项描述
  count: 1,          // 总数量
  level: 1,          // 奖项等级（数字）
  draw_count: 1      // 单次抽取数量
})
```

**4. 优化奖项等级选择**
- 将奖项等级改为数字选择（1-7）
- 移除文字等级选项（特等奖、一等奖等）
- 与数据库中的INTEGER类型保持一致

**5. 完善编辑删除功能**
- 修正 `editAward` 方法的数据映射
- 确保 `addAward` 和 `updateAward` 方法使用正确的字段名
- 保持删除功能不变

#### 主要变更

**表格列调整**：
- 按数据库字段顺序重新排列
- 使用正确的属性名（count, remaining_count, draw_count, createdAt）
- 移除计算字段，直接显示数据库字段

**表单字段修正**：
- 奖项名称：`newAward.level` → `newAward.name`
- 奖项描述：`newAward.name` → `newAward.description`
- 奖项数量：`newAward.quantity` → `newAward.count`
- 奖项等级：`newAward.awardLevel` → `newAward.level`
- 单次抽取：`newAward.drawCount` → `newAward.draw_count`

**API调用优化**：
```javascript
// 统一使用数据库字段名
const awardData = {
  name: newAward.value.name,
  description: newAward.value.description || '',
  level: newAward.value.level,
  count: newAward.value.count
}
```

#### 预期效果

**用户体验**：
- 奖项列表字段顺序与数据库一致，便于理解
- 编辑奖项功能正常工作
- 删除奖项功能保持稳定
- 数据显示更加准确

**代码质量**：
- 减少不必要的数据转换
- 字段映射更加清晰
- 代码逻辑更加简洁
- 与后端API保持一致

---

## 技术总结

### 数据一致性改进
1. **术语统一**：项目中所有"奖品"术语统一为"奖项"，提升专业性
2. **字段映射优化**：前端字段名与数据库字段名保持一致
3. **数据流简化**：减少不必要的数据转换和映射
4. **API接口规范**：统一使用数据库字段名进行数据交互

### 功能完善
1. **编辑功能修复**：修正了编辑奖项时的数据映射错误
2. **删除功能稳定**：保持删除功能的正常工作
3. **表单验证**：确保表单字段与数据库结构匹配
4. **数据显示**：按照数据库字段顺序显示，便于理解

### 代码质量提升
1. **可维护性**：简化的数据映射逻辑更易于维护
2. **一致性**：前后端数据结构保持一致
3. **可读性**：统一的术语和字段名提升代码可读性
4. **扩展性**：规范的数据结构便于后续功能扩展

---

## 风险评估

### 低风险
- 主要是前端显示调整和术语统一，不影响核心业务逻辑
- 后端API接口保持不变
- 数据库结构未改变

### 注意事项
- 需要测试编辑和删除功能是否正常
- 确保奖项等级的数字显示符合用户期望
- 验证统计数据计算是否正确
- 新增功能时应统一使用"奖项"术语

---

## 后续计划
1. 测试奖项的增删改功能
2. 验证与抽奖功能的兼容性
3. 根据用户反馈调整奖项等级显示方式
4. 文档更新时需要保持术语一致性
5. 如有遗漏的地方，应及时补充修改

---

## 状态
✅ 所有优化已完成

## 影响文件
- `frontend/src/components/AdminPage.vue`
- `frontend/src/components/LotteryPage.vue`
- `backend/src/routes/awards.js`
- `backend/src/routes/lottery.js`

## 决策理由
通过术语统一和数据结构优化，提高了项目的专业性和一致性。调整字段顺序与数据库保持一致，简化数据映射逻辑，可以提高代码的可维护性和数据的一致性。同时确保编辑删除功能正常工作，满足用户的基本管理需求。